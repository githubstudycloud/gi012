# Platform Enterprise - 技术栈规范

> 定义项目所有技术组件的版本要求和使用规范

## 1. 版本基线

### 1.1 核心版本锁定

```yaml
# ==================== 后端技术栈 ====================
java:
  version: 21                    # LTS 版本，支持虚拟线程
  vendor: Eclipse Temurin        # 推荐 JDK 发行版

spring:
  boot: 4.0.1                    # 2025.12 发布
  framework: 7.0.0               # Spring Boot 4 依赖
  cloud: 2025.0.0                # Spring Cloud 兼容版本
  security: 7.0.0                # 安全框架

build:
  maven: 3.9.9                   # 构建工具
  gradle: 8.12                   # 可选构建工具

# ==================== 前端技术栈 ====================
node:
  version: 22.x                  # LTS 版本
  packageManager: pnpm@9.x       # 推荐包管理器

vue:
  core: 3.5.x                    # Vue 核心
  router: 4.4.x                  # 路由
  pinia: 3.x                     # 状态管理

build-tools:
  vite: 6.x                      # 构建工具
  typescript: 5.6.x              # 类型系统

ui-framework:
  element-plus: 2.9.x            # UI 组件库
  tailwindcss: 4.x               # CSS 框架

# ==================== 数据存储 ====================
database:
  postgresql: 17.x               # 主数据库
  redis: 8.x                     # 缓存/会话
  elasticsearch: 9.x             # 全文搜索
  mongodb: 8.x                   # 文档存储（可选）

# ==================== 消息队列 ====================
messaging:
  rabbitmq: 4.x                  # 消息队列
  kafka: 4.x                     # 流处理（可选）

# ==================== 容器化 ====================
container:
  docker: 27.x
  kubernetes: 1.31.x
  helm: 3.16.x
```

## 2. 后端技术详解

### 2.1 Spring Boot 4.0 核心特性

```java
// 1. 虚拟线程支持 - application.yml
spring:
  threads:
    virtual:
      enabled: true              // 启用虚拟线程

// 2. 声明式 HTTP 客户端
@HttpExchange("/api/users")
public interface UserClient {

    @GetExchange("/{id}")
    User getById(@PathVariable Long id);

    @PostExchange
    User create(@RequestBody User user);
}

// 3. JSpecify 空安全注解
import org.jspecify.annotations.NonNull;
import org.jspecify.annotations.Nullable;

public class UserService {

    public @NonNull User getUser(@NonNull Long id) {
        // 编译期检查空值
    }

    public @Nullable User findByEmail(@NonNull String email) {
        // 返回值可能为空
    }
}
```

### 2.2 Spring Framework 7 新特性

| 特性 | 描述 | 使用场景 |
|------|------|---------|
| BeanRegistrar | 新的配置模型 | 替代部分 @Configuration |
| API Versioning | 内置 API 版本控制 | REST API 版本管理 |
| Observability | 增强的可观测性 | 分布式追踪 |
| AOT Processing | 提前编译优化 | GraalVM 原生镜像 |

### 2.3 数据访问层

```java
// JPA 3.2 + Hibernate ORM 7.0
@Entity
@Table(name = "t_user")
public class User {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, length = 50)
    private String username;

    // Hibernate 7 支持的新类型
    @JdbcTypeCode(SqlTypes.JSON)
    private Map<String, Object> metadata;
}

// Spring Data JPA 4.x
public interface UserRepository extends JpaRepository<User, Long> {

    // 支持 Stream 返回
    @Query("SELECT u FROM User u WHERE u.status = :status")
    Stream<User> streamByStatus(@Param("status") String status);

    // 支持 Projection
    <T> List<T> findByDepartmentId(Long deptId, Class<T> type);
}
```

### 2.4 依赖管理 (pom.xml)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>4.0.1</version>
    </parent>

    <groupId>com.company</groupId>
    <artifactId>platform-parent</artifactId>
    <version>1.0.0-SNAPSHOT</version>
    <packaging>pom</packaging>

    <properties>
        <java.version>21</java.version>
        <spring-cloud.version>2025.0.0</spring-cloud.version>
        <mapstruct.version>1.6.3</mapstruct.version>
        <springdoc.version>2.8.0</springdoc.version>
    </properties>

    <dependencyManagement>
        <dependencies>
            <!-- Spring Cloud BOM -->
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-dependencies</artifactId>
                <version>${spring-cloud.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>

            <!-- MapStruct -->
            <dependency>
                <groupId>org.mapstruct</groupId>
                <artifactId>mapstruct</artifactId>
                <version>${mapstruct.version}</version>
            </dependency>

            <!-- OpenAPI 文档 -->
            <dependency>
                <groupId>org.springdoc</groupId>
                <artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
                <version>${springdoc.version}</version>
            </dependency>
        </dependencies>
    </dependencyManagement>
</project>
```

## 3. 前端技术详解

### 3.1 Vue 3.5 核心特性

```typescript
// 1. Composition API + TypeScript
<script setup lang="ts">
import { ref, computed, watch, onMounted } from 'vue'
import { useTemplateRef } from 'vue'
import { useUserStore } from '@/stores/user'

// Props 定义
interface Props {
  userId: number
  readonly?: boolean
}

const props = withDefaults(defineProps<Props>(), {
  readonly: false
})

// Emits 定义
const emit = defineEmits<{
  (e: 'update', user: User): void
  (e: 'delete', id: number): void
}>()

// 响应式状态
const loading = ref(false)
const user = ref<User | null>(null)

// Store
const userStore = useUserStore()

// 计算属性
const fullName = computed(() =>
  user.value ? `${user.value.firstName} ${user.value.lastName}` : ''
)

// 模板引用 (Vue 3.5 新特性)
const formRef = useTemplateRef<HTMLFormElement>('form')

// 生命周期
onMounted(async () => {
  await loadUser()
})

// 方法
async function loadUser() {
  loading.value = true
  try {
    user.value = await userStore.fetchUser(props.userId)
  } finally {
    loading.value = false
  }
}
</script>
```

### 3.2 Pinia 状态管理

```typescript
// stores/user.ts
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import type { User } from '@/types'
import { userApi } from '@/api'

export const useUserStore = defineStore('user', () => {
  // 状态
  const currentUser = ref<User | null>(null)
  const users = ref<User[]>([])
  const loading = ref(false)

  // 计算属性
  const isLoggedIn = computed(() => currentUser.value !== null)
  const userCount = computed(() => users.value.length)

  // Actions
  async function login(credentials: LoginCredentials) {
    loading.value = true
    try {
      const response = await userApi.login(credentials)
      currentUser.value = response.user
      localStorage.setItem('token', response.token)
    } finally {
      loading.value = false
    }
  }

  async function logout() {
    currentUser.value = null
    localStorage.removeItem('token')
  }

  async function fetchUser(id: number): Promise<User> {
    return await userApi.getById(id)
  }

  // 暴露
  return {
    currentUser,
    users,
    loading,
    isLoggedIn,
    userCount,
    login,
    logout,
    fetchUser
  }
})
```

### 3.3 Vite 配置

```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import vueJsx from '@vitejs/plugin-vue-jsx'
import { resolve } from 'path'
import AutoImport from 'unplugin-auto-import/vite'
import Components from 'unplugin-vue-components/vite'
import { ElementPlusResolver } from 'unplugin-vue-components/resolvers'

export default defineConfig({
  plugins: [
    vue(),
    vueJsx(),
    AutoImport({
      imports: ['vue', 'vue-router', 'pinia'],
      resolvers: [ElementPlusResolver()],
      dts: 'src/auto-imports.d.ts'
    }),
    Components({
      resolvers: [ElementPlusResolver()],
      dts: 'src/components.d.ts'
    })
  ],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src')
    }
  },
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true
      }
    }
  },
  build: {
    target: 'esnext',
    minify: 'terser',
    rollupOptions: {
      output: {
        manualChunks: {
          'vue-vendor': ['vue', 'vue-router', 'pinia'],
          'element-plus': ['element-plus']
        }
      }
    }
  }
})
```

## 4. 中间件规范

### 4.1 Redis 使用规范

```yaml
# Key 命名规范
pattern: "{系统}:{模块}:{业务}:{标识}"

examples:
  - "platform:auth:token:{userId}"      # 用户令牌
  - "platform:user:info:{userId}"       # 用户信息缓存
  - "platform:cache:dict:{type}"        # 字典缓存
  - "platform:lock:order:{orderId}"     # 分布式锁

# 过期时间规范
ttl:
  token: 7200          # 令牌 2 小时
  cache: 3600          # 一般缓存 1 小时
  hot-data: 86400      # 热点数据 1 天
  lock: 30             # 分布式锁 30 秒
```

### 4.2 消息队列规范

```yaml
# Exchange 命名
exchange:
  direct: "platform.direct.{业务}"
  topic: "platform.topic.{业务}"
  fanout: "platform.fanout.{业务}"

# Queue 命名
queue: "platform.{服务}.{功能}"

# Routing Key 命名
routing-key: "{服务}.{动作}.{对象}"

examples:
  exchange: "platform.topic.order"
  queue: "platform.user.notification"
  routing-key: "order.created.notify"
```

## 5. 版本升级策略

### 5.1 依赖升级周期

| 类型 | 周期 | 策略 |
|------|------|------|
| 安全补丁 | 立即 | 发现安全漏洞后 24 小时内升级 |
| Bug 修复 | 每月 | 每月评估一次 bugfix 版本 |
| 次要版本 | 每季度 | 每季度评估 minor 版本升级 |
| 主要版本 | 按需 | 新项目采用，老项目评估迁移成本 |

### 5.2 兼容性矩阵

```
Spring Boot 4.0.x
├── Spring Framework 7.0.x
├── Spring Security 7.0.x
├── Spring Cloud 2025.0.x
├── Hibernate 7.0.x
└── Jakarta EE 11

Vue 3.5.x
├── Vue Router 4.4.x
├── Pinia 3.x
├── Vite 6.x
└── TypeScript 5.6.x
```

## 6. 禁止使用清单

### 6.1 后端禁止项

| 禁止项 | 原因 | 替代方案 |
|--------|------|---------|
| Lombok | 调试困难，IDE 依赖 | Record 类 / IDE 生成 |
| XML 配置 | 维护成本高 | Java Config / YAML |
| JSP | 已过时 | Thymeleaf / 前后端分离 |
| Servlet 2.x API | Spring Boot 4 不支持 | Servlet 6.1 |
| javax.* 包 | 已迁移 | jakarta.* |

### 6.2 前端禁止项

| 禁止项 | 原因 | 替代方案 |
|--------|------|---------|
| Options API | 代码复用性差 | Composition API |
| Vuex | 已废弃 | Pinia |
| Webpack | 性能较差 | Vite |
| JavaScript | 类型不安全 | TypeScript |
| var 关键字 | 作用域问题 | const / let |

---

**文档版本**: 1.0.0
**最后更新**: 2026-01-06
