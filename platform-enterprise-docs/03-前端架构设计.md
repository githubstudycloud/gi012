# Platform Enterprise - 前端架构设计

> 基于 Vue 3.5 + TypeScript 的企业级前端架构

## 1. 技术架构

### 1.1 技术栈概览

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         Platform UI Architecture                         │
├─────────────────────────────────────────────────────────────────────────┤
│  View Layer      │  Vue 3.5 + Composition API + JSX                     │
├─────────────────────────────────────────────────────────────────────────┤
│  State Layer     │  Pinia 3.x (Global) + Composables (Local)            │
├─────────────────────────────────────────────────────────────────────────┤
│  Router Layer    │  Vue Router 4.4.x + Route Guards                     │
├─────────────────────────────────────────────────────────────────────────┤
│  HTTP Layer      │  Axios + Request/Response Interceptors               │
├─────────────────────────────────────────────────────────────────────────┤
│  UI Layer        │  Element Plus 2.9 + TailwindCSS 4.x                  │
├─────────────────────────────────────────────────────────────────────────┤
│  Build Layer     │  Vite 6.x + TypeScript 5.6 + ESLint + Prettier       │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.2 项目结构

```
platform-ui/
├── public/                      # 静态资源
│   ├── favicon.ico
│   └── manifest.json
│
├── src/
│   ├── api/                     # API 接口定义
│   │   ├── modules/            # 按模块划分
│   │   │   ├── auth.ts
│   │   │   ├── user.ts
│   │   │   └── business.ts
│   │   ├── request.ts          # Axios 封装
│   │   └── index.ts
│   │
│   ├── assets/                  # 资源文件
│   │   ├── images/
│   │   ├── icons/
│   │   └── styles/
│   │       ├── variables.css   # CSS 变量
│   │       ├── reset.css       # 重置样式
│   │       └── global.css      # 全局样式
│   │
│   ├── components/              # 通用组件
│   │   ├── base/               # 基础组件
│   │   │   ├── BaseButton.vue
│   │   │   ├── BaseInput.vue
│   │   │   └── BaseModal.vue
│   │   ├── business/           # 业务组件
│   │   │   ├── UserSelect.vue
│   │   │   └── DeptTree.vue
│   │   └── layout/             # 布局组件
│   │       ├── AppHeader.vue
│   │       ├── AppSidebar.vue
│   │       └── AppFooter.vue
│   │
│   ├── composables/             # 组合式函数
│   │   ├── useAuth.ts
│   │   ├── useTable.ts
│   │   ├── useForm.ts
│   │   ├── usePermission.ts
│   │   └── useTheme.ts
│   │
│   ├── constants/               # 常量定义
│   │   ├── api.ts              # API 常量
│   │   ├── storage.ts          # 存储 Key
│   │   └── enums.ts            # 枚举值
│   │
│   ├── directives/              # 自定义指令
│   │   ├── permission.ts       # 权限指令
│   │   ├── loading.ts          # 加载指令
│   │   └── index.ts
│   │
│   ├── layouts/                 # 页面布局
│   │   ├── DefaultLayout.vue   # 默认布局
│   │   ├── BlankLayout.vue     # 空白布局
│   │   └── AuthLayout.vue      # 认证布局
│   │
│   ├── plugins/                 # 插件
│   │   ├── element-plus.ts     # Element Plus 配置
│   │   ├── pinia.ts            # Pinia 配置
│   │   └── index.ts
│   │
│   ├── router/                  # 路由配置
│   │   ├── routes/             # 路由模块
│   │   │   ├── auth.ts
│   │   │   ├── dashboard.ts
│   │   │   └── system.ts
│   │   ├── guards.ts           # 路由守卫
│   │   └── index.ts
│   │
│   ├── stores/                  # Pinia 状态
│   │   ├── modules/
│   │   │   ├── auth.ts         # 认证状态
│   │   │   ├── user.ts         # 用户状态
│   │   │   ├── app.ts          # 应用状态
│   │   │   └── permission.ts   # 权限状态
│   │   └── index.ts
│   │
│   ├── types/                   # TypeScript 类型
│   │   ├── api.d.ts            # API 类型
│   │   ├── components.d.ts     # 组件类型
│   │   ├── global.d.ts         # 全局类型
│   │   └── env.d.ts            # 环境变量类型
│   │
│   ├── utils/                   # 工具函数
│   │   ├── auth.ts             # 认证工具
│   │   ├── storage.ts          # 存储工具
│   │   ├── format.ts           # 格式化工具
│   │   ├── validate.ts         # 验证工具
│   │   └── index.ts
│   │
│   ├── views/                   # 页面视图
│   │   ├── auth/               # 认证页面
│   │   │   ├── Login.vue
│   │   │   └── Register.vue
│   │   ├── dashboard/          # 仪表盘
│   │   │   └── Index.vue
│   │   ├── system/             # 系统管理
│   │   │   ├── user/
│   │   │   ├── role/
│   │   │   └── menu/
│   │   └── error/              # 错误页面
│   │       ├── 404.vue
│   │       └── 500.vue
│   │
│   ├── App.vue                  # 根组件
│   └── main.ts                  # 入口文件
│
├── .env                         # 默认环境变量
├── .env.development             # 开发环境
├── .env.production              # 生产环境
├── .eslintrc.cjs                # ESLint 配置
├── .prettierrc                  # Prettier 配置
├── index.html                   # HTML 模板
├── package.json
├── tsconfig.json                # TypeScript 配置
├── tailwind.config.js           # Tailwind 配置
└── vite.config.ts               # Vite 配置
```

## 2. 核心模块实现

### 2.1 HTTP 请求封装

```typescript
// src/api/request.ts
import axios, { type AxiosInstance, type AxiosRequestConfig, type AxiosResponse } from 'axios'
import { ElMessage, ElMessageBox } from 'element-plus'
import { useAuthStore } from '@/stores/modules/auth'
import router from '@/router'

// 响应类型
interface ApiResponse<T = any> {
  code: number
  message: string
  data: T
  timestamp: number
}

// 创建实例
const service: AxiosInstance = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json'
  }
})

// 请求拦截器
service.interceptors.request.use(
  (config) => {
    const authStore = useAuthStore()

    // 添加令牌
    if (authStore.token) {
      config.headers.Authorization = `Bearer ${authStore.token}`
    }

    // 添加请求 ID (用于追踪)
    config.headers['X-Request-Id'] = crypto.randomUUID()

    return config
  },
  (error) => {
    return Promise.reject(error)
  }
)

// 响应拦截器
service.interceptors.response.use(
  (response: AxiosResponse<ApiResponse>) => {
    const { code, message, data } = response.data

    // 成功
    if (code === 200) {
      return data
    }

    // 业务错误
    ElMessage.error(message || '请求失败')
    return Promise.reject(new Error(message))
  },
  async (error) => {
    const { response } = error
    const authStore = useAuthStore()

    if (response) {
      switch (response.status) {
        case 401:
          // 令牌过期，尝试刷新
          if (!error.config._retry && authStore.refreshToken) {
            error.config._retry = true
            try {
              await authStore.refreshAccessToken()
              return service(error.config)
            } catch {
              // 刷新失败，登出
              await authStore.logout()
              router.push('/login')
            }
          } else {
            await authStore.logout()
            router.push('/login')
          }
          break

        case 403:
          ElMessage.error('没有权限访问该资源')
          break

        case 404:
          ElMessage.error('请求的资源不存在')
          break

        case 500:
          ElMessage.error('服务器内部错误')
          break

        default:
          ElMessage.error(response.data?.message || '请求失败')
      }
    } else if (error.code === 'ECONNABORTED') {
      ElMessage.error('请求超时')
    } else {
      ElMessage.error('网络连接失败')
    }

    return Promise.reject(error)
  }
)

// 封装请求方法
export const request = {
  get<T>(url: string, params?: object, config?: AxiosRequestConfig): Promise<T> {
    return service.get(url, { params, ...config })
  },

  post<T>(url: string, data?: object, config?: AxiosRequestConfig): Promise<T> {
    return service.post(url, data, config)
  },

  put<T>(url: string, data?: object, config?: AxiosRequestConfig): Promise<T> {
    return service.put(url, data, config)
  },

  delete<T>(url: string, config?: AxiosRequestConfig): Promise<T> {
    return service.delete(url, config)
  },

  upload<T>(url: string, file: File, config?: AxiosRequestConfig): Promise<T> {
    const formData = new FormData()
    formData.append('file', file)
    return service.post(url, formData, {
      headers: { 'Content-Type': 'multipart/form-data' },
      ...config
    })
  }
}

export default service
```

### 2.2 API 模块定义

```typescript
// src/api/modules/user.ts
import { request } from '../request'
import type { User, CreateUserRequest, UpdateUserRequest, PageResponse, PageRequest } from '@/types'

export const userApi = {
  /**
   * 获取用户详情
   */
  getById(id: number): Promise<User> {
    return request.get(`/users/${id}`)
  },

  /**
   * 获取用户列表
   */
  list(params: PageRequest & { keyword?: string }): Promise<PageResponse<User>> {
    return request.get('/users', params)
  },

  /**
   * 创建用户
   */
  create(data: CreateUserRequest): Promise<User> {
    return request.post('/users', data)
  },

  /**
   * 更新用户
   */
  update(id: number, data: UpdateUserRequest): Promise<User> {
    return request.put(`/users/${id}`, data)
  },

  /**
   * 删除用户
   */
  delete(id: number): Promise<void> {
    return request.delete(`/users/${id}`)
  },

  /**
   * 批量删除
   */
  batchDelete(ids: number[]): Promise<void> {
    return request.post('/users/batch-delete', { ids })
  },

  /**
   * 重置密码
   */
  resetPassword(id: number): Promise<void> {
    return request.post(`/users/${id}/reset-password`)
  },

  /**
   * 启用/禁用用户
   */
  updateStatus(id: number, status: 'ACTIVE' | 'DISABLED'): Promise<void> {
    return request.put(`/users/${id}/status`, { status })
  }
}
```

### 2.3 Pinia Store 设计

```typescript
// src/stores/modules/auth.ts
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import { authApi } from '@/api/modules/auth'
import { useStorage } from '@/composables/useStorage'
import type { User, LoginRequest, LoginResponse } from '@/types'

export const useAuthStore = defineStore('auth', () => {
  // 状态
  const token = ref<string | null>(useStorage.get('token'))
  const refreshToken = ref<string | null>(useStorage.get('refreshToken'))
  const user = ref<User | null>(null)

  // 计算属性
  const isLoggedIn = computed(() => !!token.value)
  const userRoles = computed(() => user.value?.roles || [])
  const userPermissions = computed(() => user.value?.permissions || [])

  // Actions
  async function login(credentials: LoginRequest): Promise<void> {
    const response = await authApi.login(credentials)

    token.value = response.accessToken
    refreshToken.value = response.refreshToken
    user.value = response.userInfo

    // 持久化
    useStorage.set('token', response.accessToken)
    useStorage.set('refreshToken', response.refreshToken)
  }

  async function logout(): Promise<void> {
    try {
      if (token.value) {
        await authApi.logout()
      }
    } finally {
      // 清理状态
      token.value = null
      refreshToken.value = null
      user.value = null

      useStorage.remove('token')
      useStorage.remove('refreshToken')
    }
  }

  async function refreshAccessToken(): Promise<void> {
    if (!refreshToken.value) {
      throw new Error('No refresh token')
    }

    const response = await authApi.refresh(refreshToken.value)
    token.value = response.accessToken
    useStorage.set('token', response.accessToken)
  }

  async function fetchUserInfo(): Promise<void> {
    if (!token.value) return
    user.value = await authApi.getCurrentUser()
  }

  function hasRole(role: string): boolean {
    return userRoles.value.includes(role)
  }

  function hasPermission(permission: string): boolean {
    return userPermissions.value.includes(permission)
  }

  return {
    // 状态
    token,
    refreshToken,
    user,

    // 计算属性
    isLoggedIn,
    userRoles,
    userPermissions,

    // Actions
    login,
    logout,
    refreshAccessToken,
    fetchUserInfo,
    hasRole,
    hasPermission
  }
})
```

### 2.4 组合式函数 (Composables)

```typescript
// src/composables/useTable.ts
import { ref, reactive, computed, onMounted, watch } from 'vue'
import type { Ref } from 'vue'

interface UseTableOptions<T, Q> {
  fetchData: (params: Q & { page: number; size: number }) => Promise<{
    items: T[]
    total: number
  }>
  defaultQuery?: Partial<Q>
  defaultPageSize?: number
  immediate?: boolean
}

export function useTable<T = any, Q = Record<string, any>>(options: UseTableOptions<T, Q>) {
  const {
    fetchData,
    defaultQuery = {} as Q,
    defaultPageSize = 10,
    immediate = true
  } = options

  // 状态
  const loading = ref(false)
  const data: Ref<T[]> = ref([])
  const total = ref(0)
  const page = ref(1)
  const pageSize = ref(defaultPageSize)
  const query = reactive({ ...defaultQuery }) as Q

  // 选中项
  const selectedRows: Ref<T[]> = ref([])
  const selectedIds = computed(() =>
    selectedRows.value.map((row: any) => row.id)
  )

  // 加载数据
  async function loadData() {
    loading.value = true
    try {
      const response = await fetchData({
        ...query,
        page: page.value,
        size: pageSize.value
      })
      data.value = response.items
      total.value = response.total
    } finally {
      loading.value = false
    }
  }

  // 刷新 (保持当前页)
  function refresh() {
    loadData()
  }

  // 重置 (回到第一页)
  function reset() {
    page.value = 1
    Object.assign(query, defaultQuery)
    loadData()
  }

  // 搜索 (重置到第一页)
  function search() {
    page.value = 1
    loadData()
  }

  // 分页变化
  function handlePageChange(newPage: number) {
    page.value = newPage
    loadData()
  }

  function handleSizeChange(newSize: number) {
    pageSize.value = newSize
    page.value = 1
    loadData()
  }

  // 选择变化
  function handleSelectionChange(rows: T[]) {
    selectedRows.value = rows
  }

  // 清空选择
  function clearSelection() {
    selectedRows.value = []
  }

  // 初始加载
  if (immediate) {
    onMounted(() => loadData())
  }

  return {
    // 状态
    loading,
    data,
    total,
    page,
    pageSize,
    query,

    // 选中
    selectedRows,
    selectedIds,

    // 方法
    loadData,
    refresh,
    reset,
    search,
    handlePageChange,
    handleSizeChange,
    handleSelectionChange,
    clearSelection
  }
}

// src/composables/useForm.ts
import { ref, reactive } from 'vue'
import type { FormInstance, FormRules } from 'element-plus'

interface UseFormOptions<T> {
  initialValues: T
  rules?: FormRules
  onSubmit: (values: T) => Promise<void>
}

export function useForm<T extends object>(options: UseFormOptions<T>) {
  const { initialValues, rules = {}, onSubmit } = options

  const formRef = ref<FormInstance>()
  const loading = ref(false)
  const formData = reactive({ ...initialValues }) as T

  async function submit() {
    if (!formRef.value) return

    const valid = await formRef.value.validate().catch(() => false)
    if (!valid) return

    loading.value = true
    try {
      await onSubmit(formData)
    } finally {
      loading.value = false
    }
  }

  function reset() {
    formRef.value?.resetFields()
    Object.assign(formData, initialValues)
  }

  function setValues(values: Partial<T>) {
    Object.assign(formData, values)
  }

  return {
    formRef,
    formData,
    loading,
    rules,
    submit,
    reset,
    setValues
  }
}
```

### 2.5 路由配置

```typescript
// src/router/index.ts
import { createRouter, createWebHistory } from 'vue-router'
import type { RouteRecordRaw } from 'vue-router'
import { setupRouterGuards } from './guards'

// 静态路由
const staticRoutes: RouteRecordRaw[] = [
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/views/auth/Login.vue'),
    meta: { title: '登录', layout: 'auth' }
  },
  {
    path: '/404',
    name: 'NotFound',
    component: () => import('@/views/error/404.vue'),
    meta: { title: '页面不存在', layout: 'blank' }
  }
]

// 动态路由 (需要权限)
export const asyncRoutes: RouteRecordRaw[] = [
  {
    path: '/',
    redirect: '/dashboard'
  },
  {
    path: '/dashboard',
    name: 'Dashboard',
    component: () => import('@/views/dashboard/Index.vue'),
    meta: { title: '仪表盘', icon: 'dashboard' }
  },
  {
    path: '/system',
    name: 'System',
    meta: { title: '系统管理', icon: 'setting' },
    children: [
      {
        path: 'user',
        name: 'SystemUser',
        component: () => import('@/views/system/user/Index.vue'),
        meta: { title: '用户管理', permission: 'system:user:view' }
      },
      {
        path: 'role',
        name: 'SystemRole',
        component: () => import('@/views/system/role/Index.vue'),
        meta: { title: '角色管理', permission: 'system:role:view' }
      },
      {
        path: 'menu',
        name: 'SystemMenu',
        component: () => import('@/views/system/menu/Index.vue'),
        meta: { title: '菜单管理', permission: 'system:menu:view' }
      }
    ]
  }
]

const router = createRouter({
  history: createWebHistory(import.meta.env.BASE_URL),
  routes: staticRoutes,
  scrollBehavior: () => ({ top: 0 })
})

// 设置路由守卫
setupRouterGuards(router)

export default router

// src/router/guards.ts
import type { Router } from 'vue-router'
import { useAuthStore } from '@/stores/modules/auth'
import { usePermissionStore } from '@/stores/modules/permission'
import NProgress from 'nprogress'

// 白名单
const whiteList = ['/login', '/register', '/404']

export function setupRouterGuards(router: Router) {
  router.beforeEach(async (to, from, next) => {
    NProgress.start()

    const authStore = useAuthStore()
    const permissionStore = usePermissionStore()

    // 白名单直接放行
    if (whiteList.includes(to.path)) {
      next()
      return
    }

    // 未登录跳转登录页
    if (!authStore.isLoggedIn) {
      next({ path: '/login', query: { redirect: to.fullPath } })
      return
    }

    // 获取用户信息
    if (!authStore.user) {
      try {
        await authStore.fetchUserInfo()
        // 生成动态路由
        const accessRoutes = await permissionStore.generateRoutes()
        accessRoutes.forEach((route) => router.addRoute(route))
        next({ ...to, replace: true })
        return
      } catch {
        await authStore.logout()
        next({ path: '/login', query: { redirect: to.fullPath } })
        return
      }
    }

    // 权限检查
    const permission = to.meta.permission as string | undefined
    if (permission && !authStore.hasPermission(permission)) {
      next('/404')
      return
    }

    next()
  })

  router.afterEach((to) => {
    NProgress.done()
    // 设置页面标题
    document.title = to.meta.title ? `${to.meta.title} - Platform` : 'Platform'
  })
}
```

## 3. 组件设计规范

### 3.1 基础组件示例

```vue
<!-- src/components/base/BaseTable.vue -->
<template>
  <div class="base-table">
    <!-- 工具栏 -->
    <div v-if="$slots.toolbar" class="base-table__toolbar">
      <slot name="toolbar" />
    </div>

    <!-- 表格 -->
    <el-table
      ref="tableRef"
      v-loading="loading"
      :data="data"
      :row-key="rowKey"
      :border="border"
      @selection-change="handleSelectionChange"
    >
      <!-- 选择列 -->
      <el-table-column v-if="selectable" type="selection" width="55" />

      <!-- 序号列 -->
      <el-table-column v-if="showIndex" type="index" label="序号" width="60" />

      <!-- 自定义列 -->
      <slot />

      <!-- 操作列 -->
      <el-table-column
        v-if="$slots.actions"
        label="操作"
        :width="actionsWidth"
        fixed="right"
      >
        <template #default="scope">
          <slot name="actions" v-bind="scope" />
        </template>
      </el-table-column>
    </el-table>

    <!-- 分页 -->
    <div v-if="showPagination" class="base-table__pagination">
      <el-pagination
        v-model:current-page="currentPage"
        v-model:page-size="currentPageSize"
        :total="total"
        :page-sizes="pageSizes"
        layout="total, sizes, prev, pager, next, jumper"
        @current-change="handlePageChange"
        @size-change="handleSizeChange"
      />
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue'
import type { TableInstance } from 'element-plus'

// Props
interface Props {
  data: any[]
  loading?: boolean
  total?: number
  page?: number
  pageSize?: number
  rowKey?: string
  border?: boolean
  selectable?: boolean
  showIndex?: boolean
  showPagination?: boolean
  actionsWidth?: number
  pageSizes?: number[]
}

const props = withDefaults(defineProps<Props>(), {
  loading: false,
  total: 0,
  page: 1,
  pageSize: 10,
  rowKey: 'id',
  border: true,
  selectable: false,
  showIndex: false,
  showPagination: true,
  actionsWidth: 150,
  pageSizes: () => [10, 20, 50, 100]
})

// Emits
const emit = defineEmits<{
  (e: 'update:page', page: number): void
  (e: 'update:pageSize', size: number): void
  (e: 'page-change', page: number): void
  (e: 'size-change', size: number): void
  (e: 'selection-change', rows: any[]): void
}>()

// Refs
const tableRef = ref<TableInstance>()

// 双向绑定分页
const currentPage = computed({
  get: () => props.page,
  set: (val) => emit('update:page', val)
})

const currentPageSize = computed({
  get: () => props.pageSize,
  set: (val) => emit('update:pageSize', val)
})

// 事件处理
function handlePageChange(page: number) {
  emit('page-change', page)
}

function handleSizeChange(size: number) {
  emit('size-change', size)
}

function handleSelectionChange(rows: any[]) {
  emit('selection-change', rows)
}

// 暴露方法
defineExpose({
  clearSelection: () => tableRef.value?.clearSelection()
})
</script>

<style scoped>
.base-table__toolbar {
  margin-bottom: 16px;
}

.base-table__pagination {
  margin-top: 16px;
  display: flex;
  justify-content: flex-end;
}
</style>
```

### 3.2 页面组件示例

```vue
<!-- src/views/system/user/Index.vue -->
<template>
  <div class="user-management">
    <!-- 搜索表单 -->
    <el-card class="mb-4">
      <el-form :model="query" inline>
        <el-form-item label="关键词">
          <el-input
            v-model="query.keyword"
            placeholder="用户名/昵称"
            clearable
            @keyup.enter="search"
          />
        </el-form-item>
        <el-form-item label="状态">
          <el-select v-model="query.status" placeholder="全部" clearable>
            <el-option label="正常" value="ACTIVE" />
            <el-option label="禁用" value="DISABLED" />
          </el-select>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="search">搜索</el-button>
          <el-button @click="reset">重置</el-button>
        </el-form-item>
      </el-form>
    </el-card>

    <!-- 数据表格 -->
    <el-card>
      <BaseTable
        :data="data"
        :loading="loading"
        :total="total"
        v-model:page="page"
        v-model:page-size="pageSize"
        selectable
        @page-change="loadData"
        @size-change="handleSizeChange"
        @selection-change="handleSelectionChange"
      >
        <template #toolbar>
          <el-button type="primary" @click="handleCreate">
            <el-icon><Plus /></el-icon>新增用户
          </el-button>
          <el-button
            type="danger"
            :disabled="selectedIds.length === 0"
            @click="handleBatchDelete"
          >
            批量删除
          </el-button>
        </template>

        <el-table-column prop="username" label="用户名" />
        <el-table-column prop="nickname" label="昵称" />
        <el-table-column prop="email" label="邮箱" />
        <el-table-column prop="status" label="状态">
          <template #default="{ row }">
            <el-tag :type="row.status === 'ACTIVE' ? 'success' : 'danger'">
              {{ row.status === 'ACTIVE' ? '正常' : '禁用' }}
            </el-tag>
          </template>
        </el-table-column>
        <el-table-column prop="createdAt" label="创建时间" width="180" />

        <template #actions="{ row }">
          <el-button type="primary" link @click="handleEdit(row)">编辑</el-button>
          <el-button type="danger" link @click="handleDelete(row)">删除</el-button>
        </template>
      </BaseTable>
    </el-card>

    <!-- 编辑对话框 -->
    <UserFormDialog
      v-model="dialogVisible"
      :user="currentUser"
      @success="loadData"
    />
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { ElMessageBox, ElMessage } from 'element-plus'
import { Plus } from '@element-plus/icons-vue'
import { useTable } from '@/composables/useTable'
import { userApi } from '@/api/modules/user'
import BaseTable from '@/components/base/BaseTable.vue'
import UserFormDialog from './components/UserFormDialog.vue'
import type { User } from '@/types'

// 表格逻辑
const {
  loading,
  data,
  total,
  page,
  pageSize,
  query,
  selectedIds,
  loadData,
  search,
  reset,
  handleSizeChange,
  handleSelectionChange
} = useTable<User, { keyword?: string; status?: string }>({
  fetchData: userApi.list,
  defaultPageSize: 10
})

// 对话框
const dialogVisible = ref(false)
const currentUser = ref<User | null>(null)

function handleCreate() {
  currentUser.value = null
  dialogVisible.value = true
}

function handleEdit(row: User) {
  currentUser.value = row
  dialogVisible.value = true
}

async function handleDelete(row: User) {
  await ElMessageBox.confirm(`确定删除用户 "${row.username}" 吗？`, '提示', {
    type: 'warning'
  })

  await userApi.delete(row.id)
  ElMessage.success('删除成功')
  loadData()
}

async function handleBatchDelete() {
  await ElMessageBox.confirm(`确定删除选中的 ${selectedIds.value.length} 个用户吗？`, '提示', {
    type: 'warning'
  })

  await userApi.batchDelete(selectedIds.value)
  ElMessage.success('删除成功')
  loadData()
}
</script>
```

## 4. 构建配置

### 4.1 环境变量

```bash
# .env.development
VITE_APP_TITLE=Platform (开发)
VITE_API_BASE_URL=/api
VITE_UPLOAD_URL=/api/files/upload

# .env.production
VITE_APP_TITLE=Platform
VITE_API_BASE_URL=https://api.platform.com
VITE_UPLOAD_URL=https://api.platform.com/files/upload
```

### 4.2 Vite 生产构建优化

```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { visualizer } from 'rollup-plugin-visualizer'
import viteCompression from 'vite-plugin-compression'

export default defineConfig({
  plugins: [
    vue(),
    // Gzip 压缩
    viteCompression({
      algorithm: 'gzip',
      ext: '.gz'
    }),
    // 打包分析
    visualizer({
      open: true,
      gzipSize: true
    })
  ],
  build: {
    target: 'esnext',
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true
      }
    },
    rollupOptions: {
      output: {
        manualChunks: {
          'vue-vendor': ['vue', 'vue-router', 'pinia'],
          'element-plus': ['element-plus'],
          'utils': ['axios', 'dayjs', 'lodash-es']
        },
        chunkFileNames: 'assets/js/[name]-[hash].js',
        entryFileNames: 'assets/js/[name]-[hash].js',
        assetFileNames: 'assets/[ext]/[name]-[hash].[ext]'
      }
    },
    chunkSizeWarningLimit: 1000
  }
})
```

---

**文档版本**: 1.0.0
**最后更新**: 2026-01-06
